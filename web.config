<?xml version="1.0" encoding="UTF-8"?>
<!--
    web.config para SACSBD - Despliegue en IIS
    
    INSTRUCCIONES:
    1. Instalar Python en el servidor (ej: C:\Python313)
    2. Instalar wfastcgi: pip install wfastcgi
    3. Habilitar wfastcgi: wfastcgi-enable
    4. Copiar este archivo a la raíz del proyecto
    5. Actualizar las rutas según tu servidor
-->
<configuration>
    <system.webServer>
        <handlers>
            <add name="Python FastCGI" 
                 path="*" 
                 verb="*" 
                 modules="FastCgiModule" 
                 scriptProcessor="C:\Python313\python.exe|C:\Python313\Lib\site-packages\wfastcgi.py"
                 resourceType="Unspecified" 
                 requireAccess="Script" />
        </handlers>
        
        <!-- Configuración de URL Rewrite para archivos estáticos -->
        <rewrite>
            <rules>
                <!-- Servir archivos estáticos directamente -->
                <rule name="Static Files" stopProcessing="true">
                    <match url="^static/(.*)$" />
                    <action type="Rewrite" url="staticfiles/{R:1}" />
                </rule>
                <rule name="Media Files" stopProcessing="true">
                    <match url="^media/(.*)$" />
                    <action type="Rewrite" url="media/{R:1}" />
                </rule>
            </rules>
        </rewrite>
        
        <!-- Configuración de directorios estáticos -->
        <staticContent>
            <mimeMap fileExtension=".woff" mimeType="application/font-woff" />
            <mimeMap fileExtension=".woff2" mimeType="application/font-woff2" />
            <mimeMap fileExtension=".json" mimeType="application/json" />
            <mimeMap fileExtension=".svg" mimeType="image/svg+xml" />
        </staticContent>
        
        <!-- Configuración de errores personalizados -->
        <httpErrors errorMode="Detailed" />
        
        <!-- Aumentar timeout para operaciones largas -->
        <aspNetCore requestTimeout="00:05:00" />
        
    </system.webServer>
    
    <appSettings>
        <!-- Ruta al archivo WSGI de producción -->
        <add key="WSGI_HANDLER" value="sacsbd_project.wsgi_production.application" />
        
        <!-- Ruta raíz del proyecto Django -->
        <add key="PYTHONPATH" value="C:\inetpub\wwwroot\sacsbd" />
        
        <!-- Configuración de Django -->
        <add key="DJANGO_SETTINGS_MODULE" value="sacsbd_project.settings.production" />
        
        <!-- Variables de entorno para la base de datos -->
        <add key="DB_NAME" value="sacs_bd" />
        <add key="DB_USER" value="oejaramillop1" />
        <add key="DB_PASSWORD" value="O2c4r793@J4r4#2060" />
        <add key="DB_HOST" value="HeonSacsDB" />
        <add key="DB_PORT" value="" />
        <add key="DB_DRIVER" value="ODBC Driver 17 for SQL Server" />
        
        <!-- Hosts permitidos -->
        <add key="ALLOWED_HOSTS" value="localhost,127.0.0.1" />
        
        <!-- Secret Key - CAMBIAR EN PRODUCCIÓN -->
        <add key="SECRET_KEY" value="GENERA-UNA-CLAVE-SEGURA-AQUI-MINIMO-50-CARACTERES" />
        
        <!-- Debug siempre False en producción -->
        <add key="DEBUG" value="False" />
    </appSettings>
</configuration>
