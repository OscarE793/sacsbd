{% extends 'reportes/base.html' %}\n\n{% block title %}{{ titulo }} - SACSBD{% endblock %}\n{% block page_title %}{{ titulo }}{% endblock %}\n\n{% block content %}\n<div class=\"px-4 py-6 sm:px-0\">\n    <!-- Header con botón de descarga -->\n    <div class=\"flex justify-between items-center mb-6\">\n        <div>\n            <h2 class=\"text-xl font-semibold text-gray-900\">{{ titulo }}</h2>\n            {% if descripcion %}\n                <p class=\"text-sm text-gray-600 mt-1\">{{ descripcion }}</p>\n            {% endif %}\n        </div>\n        <div class=\"flex space-x-3\">\n            {% if excel_url %}\n                <a href=\"{{ excel_url }}\" class=\"kt-btn kt-btn-success\">\n                    <i class=\"ki-duotone ki-file-down mr-2\"></i>\n                    Descargar Excel\n                </a>\n            {% endif %}\n            <a href=\"{% url 'reportes:dashboard' %}\" class=\"kt-btn kt-btn-light\">\n                <i class=\"ki-duotone ki-arrow-left mr-2\"></i>\n                Volver al Dashboard\n            </a>\n        </div>\n    </div>\n\n    <!-- Filtros si existen -->\n    {% if mostrar_filtros %}\n        <div class=\"bg-white shadow rounded-lg p-6 mb-6\">\n            <h3 class=\"text-lg font-medium text-gray-900 mb-4\">Filtros</h3>\n            <form method=\"get\" class=\"grid grid-cols-1 gap-4 sm:grid-cols-3\">\n                {% if filtro_fecha %}\n                    <div>\n                        <label for=\"fecha\" class=\"block text-sm font-medium text-gray-700\">Fecha Inicio</label>\n                        <input type=\"date\" name=\"fecha\" id=\"fecha\" value=\"{{ request.GET.fecha }}\" \n                               class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\">\n                    </div>\n                    <div>\n                        <label for=\"fecha1\" class=\"block text-sm font-medium text-gray-700\">Fecha Fin</label>\n                        <input type=\"date\" name=\"fecha1\" id=\"fecha1\" value=\"{{ request.GET.fecha1 }}\" \n                               class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\">\n                    </div>\n                {% endif %}\n                <div class=\"flex items-end\">\n                    <button type=\"submit\" class=\"kt-btn kt-btn-primary\">\n                        <i class=\"ki-duotone ki-magnifier mr-2\"></i>\n                        Filtrar\n                    </button>\n                </div>\n            </form>\n        </div>\n    {% endif %}\n\n    <!-- Tabla de resultados -->\n    <div class=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n        {% if datos %}\n            <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200\">\n                    <thead class=\"bg-gray-50\">\n                        <tr>\n                            {% for encabezado in encabezados %}\n                                <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                                    {{ encabezado }}\n                                </th>\n                            {% endfor %}\n                        </tr>\n                    </thead>\n                    <tbody class=\"bg-white divide-y divide-gray-200\">\n                        {% for fila in datos %}\n                            <tr class=\"{% cycle 'bg-white' 'bg-gray-50' %}\">\n                                {% for celda in fila %}\n                                    <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                                        {{ celda|default:\"-\" }}\n                                    </td>\n                                {% endfor %}\n                            </tr>\n                        {% endfor %}\n                    </tbody>\n                </table>\n            </div>\n            \n            <!-- Información de resultados -->\n            <div class=\"bg-gray-50 px-6 py-3 border-t border-gray-200\">\n                <div class=\"flex justify-between items-center\">\n                    <div class=\"text-sm text-gray-500\">\n                        Total de registros: <span class=\"font-medium\">{{ datos|length }}</span>\n                    </div>\n                    {% if fecha_consulta %}\n                        <div class=\"text-sm text-gray-500\">\n                            Consultado el: <span class=\"font-medium\">{{ fecha_consulta }}</span>\n                        </div>\n                    {% endif %}\n                </div>\n            </div>\n        {% else %}\n            <!-- Estado vacío -->\n            <div class=\"text-center py-12\">\n                <i class=\"ki-duotone ki-file-deleted text-6xl text-gray-400 mx-auto mb-4\"></i>\n                <h3 class=\"text-lg font-medium text-gray-900 mb-2\">No hay datos disponibles</h3>\n                <p class=\"text-gray-500\">No se encontraron registros para mostrar en este reporte.</p>\n                {% if mostrar_filtros %}\n                    <p class=\"text-gray-500 mt-2\">Intenta ajustar los filtros de búsqueda.</p>\n                {% endif %}\n            </div>\n        {% endif %}\n    </div>\n\n    <!-- Botones de acción adicionales -->\n    <div class=\"mt-6 flex justify-center space-x-4\">\n        {% if actualizar_url %}\n            <a href=\"{{ actualizar_url }}\" class=\"kt-btn kt-btn-light\">\n                <i class=\"ki-duotone ki-arrows-circle mr-2\"></i>\n                Actualizar Datos\n            </a>\n        {% endif %}\n        {% if configurar_url %}\n            <a href=\"{{ configurar_url }}\" class=\"kt-btn kt-btn-light\">\n                <i class=\"ki-duotone ki-setting-2 mr-2\"></i>\n                Configurar Reporte\n            </a>\n        {% endif %}\n    </div>\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script>\n    // Auto-refresh cada 5 minutos para reportes en tiempo real\n    {% if auto_refresh %}\n        setTimeout(function() {\n            location.reload();\n        }, 300000); // 5 minutos\n    {% endif %}\n    \n    // Confirmación para descargas grandes\n    document.addEventListener('DOMContentLoaded', function() {\n        const excelBtn = document.querySelector('a[href*=\"excel\"]');\n        if (excelBtn && {{ datos|length }} > 1000) {\n            excelBtn.addEventListener('click', function(e) {\n                if (!confirm('Este reporte contiene muchos registros. La descarga puede tardar unos minutos. ¿Desea continuar?')) {\n                    e.preventDefault();\n                }\n            });\n        }\n    });\n</script>\n{% endblock %}"